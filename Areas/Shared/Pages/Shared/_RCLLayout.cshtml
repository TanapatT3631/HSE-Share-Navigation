@* SharedNavigation/Areas/Shared/Pages/Shared/_RCLLayout.cshtml *@
@using System.Security.Principal
@using System.Security.Claims;
@using Microsoft.AspNetCore.Http

<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - @ViewData["AppName"]</title>

    <link rel="stylesheet" href="~/_content/SharedNavigation/lib/fomantic-ui/dist/semantic.min.css">
    <link rel="stylesheet" href="~/_content/SharedNavigation/lib/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="~/_content/SharedNavigation/css/navigation.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans+Flex:opsz,wght@6..144,1..1000&family=Sarabun:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
        rel="stylesheet">
    @RenderSection("Styles", required: false)
</head>

<body style="overflow:hidden">

    <div id="top-nav-base">
        <header class="header-with-image"></header>
        <div class="ui menu" id="top-nav" style="top: 10px !important;margin-bottom:0">
            <div class="item">
                <img class="medium" src="~/_content/SharedNavigation/images/logo/Bosch_symbol_logo_black_red.png"
                    style="width: 10em !important;">
                <!-- <span class="ui big red text" style="font-weight:900;">BOSCH</span> -->
            </div>
            <div class="item">
                <h4>HmjP&AmaP/HSE</h4>
            </div>
            <a class="item open-sidebar"><i class="sidebar icon"></i></a>
            <div class="right menu">
                @await Html.PartialAsync("~/Areas/Shared/Pages/Shared/_PlantSelector.cshtml")
                <a class="item open-notify"><i class="bell icon"></i></a>
                <div class="item">
                    <img class="ui avatar image" src="~/_content/SharedNavigation/images/wireframes/square-image.png">
                    <span>
                        @(User.FindFirst("name")?.Value ?? User.Identity?.Name)
                        <br />
                        <small>
                            @(User.FindFirst("preferred_username")?.Value) /
                            @(User.FindFirst("custom_plant")?.Value ?? "No Plant")
                        </small>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Side Navigation - สลับระหว่างโปรเจค -->
    <div class="main-context" style="height:calc(100vh - 130px);!important;overflow-y:hidden">
        <div class="ui left vertical sidebar menu">
            <a class="item" href="http://localhost:5264">Home</a>
            <a class="item" href="http://localhost:5240">Chemical</a>
            <a class="item">EHS Data</a>
            <a class="item">MAE</a>
            <a class="item">HSE Audit</a>
            <a class="item">Laws</a>
            <a class="item">Training Records</a>
            <a class="item">Waste Management</a>
            <a class="item">Nurse Service</a>
            <a class="item">Environmental Monitoring</a>
            <a class="item">Safety Shoes Request</a>
            <a class="item">Cleam Food Audit</a>
            <a class="item">Incident Report</a>
            <a class="item">Learn to See</a>
        </div>
        @await Html.PartialAsync("~/Areas/Shared/Pages/Shared/_Notification.cshtml")


        <div class="pusher" style="max-height: 100%;overflow-y: auto;padding-bottom:10px">

            @RenderBody()

        </div>
    </div>
    <div class="ui vertical footer segment" style="height:58px">
        <div class="ui horizontal small divided link list">
            <div class="item"><img src="~/_content/SharedNavigation/images/logo/Bosch_LOGO.png" class="ui mini image">
            </div>
            <div class="item"> Designed and developed by Tanapat Tansara (HmjP/HSE)
                © 2025 Robert Bosch Automative Teachnologies (Thailand) Co., Ltd. | HmjP/HSE.</div>

        </div>
    </div>

    <!-- Project Navigation (ถ้ามี Partial ก็แสดง) -->
    @if (IsSectionDefined("ProjectNavigation"))
    {
        @RenderSection("ProjectNavigation", required: false)
    }

    <style>
        body {
            font-family: "Google Sans Flex", sans-serif !important;
        }

        /* HTML: <div class="loader"></div> */
        /* HTML: <div class="loader"></div> */
        .loader {
            align-items: center;
            vertical-align: center !important;
            width: 150px;
            aspect-ratio: 1;
            background:
                linear-gradient(90deg, #902337 50%, #574499 0) top/100% 50% no-repeat,
                linear-gradient(90deg, #34934b 50%, #2b82b7 0);
            -webkit-mask: linear-gradient(#000 0 0) 0 0/50% 50% no-repeat;
            animation: l18 2s infinite;
        }

        @@keyframes l18 {
            0% {
                -webkit-mask-position: 0 0
            }

            25% {
                -webkit-mask-position: 100% 0
            }

            50% {
                -webkit-mask-position: 100% 100%
            }

            75% {
                -webkit-mask-position: 0 100%
            }

            100% {
                -webkit-mask-position: 0 0
            }
        }
    </style>
    @* <script src="~/_content/SharedNavigation/js/navigation.js"></script> *@
    <script src="~/_content/SharedNavigation/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/_content/SharedNavigation/lib/fomantic-ui/dist/semantic.min.js"></script>
    <script src="~/_content/SharedNavigation/lib/sweetalert2/dist/sweetalert2.min.js"></script>
    <script src="~/_content/SharedNavigation/js/site.js"></script>
    <script>
        const $pusher = $('.pusher');
        $('.ui.sidebar').first().sidebar({
            context: $('.main-context'), transition: 'push', scrollLock: false, dimPage: false,

        })
            .sidebar('attach events', '.open-sidebar', 'toggle')
            ;

        $('.ui.flyout')
            .flyout({
                context: $('.main-context'), scrollLock: true, dimPage: false
            })
            .flyout('attach events', '.open-notify')
            ;

    </script>
    <script>
        const Toast = Swal.mixin({
            toast: true,
            position: "bottom-end",
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true,
            @* didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            } *@
        });
        // Initialize Fomantic UI Dropdown
        $(document).ready(function () {
            $('#plantSelector').dropdown({
                action: 'nothing', // ไม่ให้ dropdown ทำอะไรเอง เราจะจัดการเอง
                onChange: function (value, text, $selectedItem) {
                    // Empty - เราใช้ onclick แทน
                }
            });
        });

        // Change Plant Function
        function changePlant(plantCode) {
            if (!plantCode) {
                console.error('Plant code is required');
                return;
            }

            // Add loading state
            const selector = $('#plantSelector');
            selector.addClass('loading');
            $('#loading').show();
            $('#main-content').hide();
            // Send AJAX request to change plant
            $.ajax({
                url: '/_plantselector/changeplant',
                type: 'POST',
                data: JSON.stringify({ plantCode: plantCode }),
                contentType: 'application/json',
                success: function (response) {
                    if (response.success) {
                        Toast.fire({
                            icon: "success",
                            title: 'Plant Changed',
                            text: `Changed to ${response.plantName}`,
                        }).then(() => {
                            // Reload page to apply changes
                            window.location.reload();
                        });

                        @* Swal.fire({
                        icon: 'success',
                        title: 'Plant Changed',
                        text: `Changed to ${response.plantName}`,
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        // Reload page to apply changes
                        window.location.reload();
                    }); *@
                } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: response.message || 'Failed to change plant'
                        });
                        selector.removeClass('loading');
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error changing plant:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to change plant. Please try again.'
                    });
                    selector.removeClass('loading');
                }
            });
        }

        // Current Plant Info (for debugging)
        function getCurrentPlant() {
            const selector = $('#plantSelector');
            const currentText = selector.find('.text').first().text();
            console.log('Current Plant:', currentText);
            return currentText;
        }
    </script>
    @RenderSection("Scripts", required: false)
</body>

</html>