@using SharedNavigation.Models
@using SharedNavigation.Services
@inject IPlantService PlantService
@{
    List<Plant?> plants = new();
    Plant? currentPlant = null;
    string currentPlantId = "HmjP"; // default
    
    try
    {
        plants = await PlantService.GetPlantsAsync();
        currentPlant = await PlantService.GetCurrentPlantAsync();
        currentPlantId = currentPlant?.PlantCode ?? "HmjP";
    }
    catch (Exception ex)
    {
        // Log error but don't break the page
        System.Diagnostics.Debug.WriteLine($"Error loading plants: {ex.Message}");
    }
}
<div class="ui dropdown item" id="plantSelector">
    <i class="industry icon"></i>
    <span class="text">@(currentPlant?.PlantCode ?? "Select Plant") </span>
    <i class="dropdown icon"></i>
    <div class="menu">
        @foreach (var plant in plants.Where(p => p != null))
        {
            <div class="@(plant?.PlantCode == currentPlantId ? "active" : "") item" 
                 data-value="@plant?.PlantCode"
                 onclick="changePlant('@plant?.PlantCode')">
                <i class="@(plant?.PlantCode == currentPlantId ? "check" : "") icon"></i>
                <span class="text">
                    @plant?.PlantCode 
                    @if (!string.IsNullOrEmpty(plant?.PlantCode))
                    {
                        <small class="description">@plant.Name</small>
                    }
                </span>
            </div>
        }
    </div>
</div>

<style>
    #plantSelector {
        cursor: pointer;
        background: rgba(255, 255, 255, 0.1) !important;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    #plantSelector:hover {
        background: rgba(255, 255, 255, 0.2) !important;
    }

    #plantSelector .menu {
        min-width: 280px !important;
        max-height: 400px;
        overflow-y: auto;
    }

    #plantSelector .menu .item {
        padding: 12px 16px !important;
    }

    #plantSelector .menu .item .description {
        display: block;
        color: #999;
        font-size: 0.85em;
        margin-top: 4px;
    }

    #plantSelector .menu .item.active {
        background: #f0f0f0 !important;
        font-weight: 600 !important;
    }

    #plantSelector .menu .item:hover {
        background: #f8f8f8 !important;
    }

    /* Loading state */
    #plantSelector.loading {
        pointer-events: none;
        opacity: 0.7;
    }

    #plantSelector.loading .text:after {
        content: '...';
        animation: dots 1.5s infinite;
    }

    @@keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60%, 100% { content: '...'; }
    }
</style>

